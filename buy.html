<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout | APPLE STORE</title>
<link rel="icon" href="../Images/apple-logo-transparent.png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
  margin: 0;
  background: #f5f5f7;
  color: #1d1d1f;
}

.header-container {
  background: #fff;
  border-bottom: 1px solid #d2d2d7;
  padding: 0 20px;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  max-width: 1200px;
  margin: 0 auto;
  padding: 15px 0;
}

.logo {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 28px;
  font-weight: 700;
  color: #1d1d1f;
  text-decoration: none;
}

.logo img {
  height: 40px;
  width: auto;
}

.cart-icon {
  position: relative;
  font-size: 24px;
  color: #1d1d1f;
  cursor: pointer;
  padding: 10px;
  border-radius: 50%;
  transition: background 0.3s;
}

.cart-icon:hover {
  background: #f5f5f7;
}

.cart-count {
  position: absolute;
  top: -5px;
  right: -5px;
  background: #0071e3;
  color: white;
  font-size: 12px;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
}

nav {
  display: flex;
  justify-content: center;
  gap: 25px;
  background: white;
  padding: 15px;
  border-bottom: 1px solid #d2d2d7;
}

nav a {
  text-decoration: none;
  color: #1d1d1f;
  font-weight: 600;
  padding: 5px 10px;
  border-radius: 8px;
  transition: all 0.3s;
  display: flex;
  align-items: center;
  gap: 8px;
}

nav a:hover {
  color: #0071e3;
  background: #f5f5f7;
}

nav a.active {
  color: #0071e3;
  background: #f0f7ff;
  border-bottom: 2px solid #0071e3;
}

/* Main Content */
.main-container {
  max-width: 1200px;
  margin: 40px auto;
  padding: 0 20px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 40px;
}

/* Product Details */
.product-section {
  background: white;
  padding: 30px;
  border-radius: 18px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.08);
}

.product-display {
  text-align: center;
  margin-bottom: 30px;
}

.product-display img {
  width: 100%;
  max-height: 300px;
  object-fit: contain;
  background: #fafafa;
  padding: 20px;
  border-radius: 12px;
  margin-bottom: 20px;
}

.product-title {
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 15px;
  color: #1d1d1f;
}

.product-desc {
  font-size: 16px;
  color: #86868b;
  line-height: 1.6;
  margin-bottom: 20px;
}

.product-price {
  font-size: 32px;
  font-weight: 700;
  color: #0071e3;
  margin-bottom: 20px;
}

/* Checkout Section */
.checkout-section {
  background: white;
  padding: 30px;
  border-radius: 18px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.08);
}

.checkout-section h2 {
  font-size: 24px;
  margin-bottom: 25px;
  color: #1d1d1f;
  padding-bottom: 15px;
  border-bottom: 2px solid #f5f5f7;
}

/* Accordion */
.accordion-item {
  border: 1px solid #e1e1e1;
  border-radius: 12px;
  margin-bottom: 20px;
  overflow: hidden;
}

.accordion-header {
  padding: 20px;
  background: #f5f5f7;
  cursor: pointer;
  font-weight: 600;
  font-size: 17px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: background 0.3s;
}

.accordion-header:hover {
  background: #e5e5e7;
}

.accordion-header i {
  transition: transform 0.3s;
}

.accordion-content {
  display: none;
  padding: 25px;
}

.accordion-content.active {
  display: block;
}

/* Form Styles */
.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: #1d1d1f;
  font-size: 14px;
}

.input-field {
  width: 100%;
  padding: 14px;
  border-radius: 10px;
  border: 1px solid #d2d2d7;
  font-size: 15px;
  background: #f9f9fb;
  transition: border-color 0.3s;
  box-sizing: border-box;
}

.input-field:focus {
  border-color: #0071e3;
  outline: none;
  box-shadow: 0 0 0 3px rgba(0,113,227,0.1);
}

.input-field.small {
  width: calc(50% - 10px);
}

/* Payment Options */
.payment-options {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.payment-option {
  display: flex;
  align-items: center;
  padding: 15px;
  border: 2px solid #e5e5e7;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s;
}

.payment-option:hover {
  border-color: #0071e3;
  background: #f0f7ff;
}

.payment-option.selected {
  border-color: #0071e3;
  background: #f0f7ff;
}

.payment-option input {
  margin-right: 15px;
  transform: scale(1.2);
}

.payment-icon {
  margin-right: 15px;
  font-size: 24px;
  color: #0071e3;
}

.payment-label {
  flex: 1;
}

.payment-label h4 {
  margin: 0 0 5px 0;
  font-size: 16px;
}

.payment-label p {
  margin: 0;
  font-size: 14px;
  color: #86868b;
}

/* Payment Details */
.payment-details {
  margin-top: 20px;
  padding: 20px;
  background: #f5f5f7;
  border-radius: 10px;
  display: none;
}

.payment-details.active {
  display: block;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* UPI QR Code */
.upi-qr {
  text-align: center;
  padding: 20px;
}

.upi-qr img {
  width: 200px;
  height: 200px;
  border-radius: 10px;
  margin: 15px 0;
  border: 1px solid #e1e1e1;
}

.upi-id {
  background: #fff;
  padding: 12px;
  border-radius: 8px;
  font-family: monospace;
  margin: 15px 0;
  border: 1px dashed #0071e3;
}

/* EMI Calculator */
.emi-calculator {
  background: #f5f5f7;
  padding: 20px;
  border-radius: 10px;
  margin-top: 20px;
}

.emi-option {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px;
  background: white;
  border-radius: 8px;
  margin-bottom: 10px;
  border: 1px solid #e5e5e7;
  cursor: pointer;
}

.emi-option:hover {
  border-color: #0071e3;
}

.emi-option.selected {
  border-color: #0071e3;
  background: #f0f7ff;
}

/* Order Summary */
.order-summary {
  background: #f5f5f7;
  padding: 25px;
  border-radius: 12px;
  margin-top: 30px;
}

.summary-item {
  display: flex;
  justify-content: space-between;
  padding: 12px 0;
  border-bottom: 1px solid #e5e5e7;
}

.summary-item:last-child {
  border-bottom: none;
  font-weight: 700;
  font-size: 18px;
  color: #0071e3;
}

/* Buttons */
.btn {
  display: inline-block;
  padding: 16px 32px;
  border-radius: 12px;
  text-decoration: none;
  font-weight: 600;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s;
  border: none;
  text-align: center;
  width: 100%;
  margin-top: 20px;
}

.btn-primary {
  background: #0071e3;
  color: #fff;
}

.btn-primary:hover {
  background: #005bb5;
  transform: translateY(-2px);
}

.btn-success {
  background: #34c759;
  color: #fff;
}

.btn-success:hover {
  background: #2da44e;
  transform: translateY(-2px);
}

.btn-secondary {
  background: #f5f5f7;
  color: #1d1d1f;
  border: 1px solid #d2d2d7;
}

.btn-secondary:hover {
  background: #e5e5e7;
}

/* Quantity Controls */
.quantity-controls {
  display: flex;
  align-items: center;
  gap: 15px;
  margin: 20px 0;
  padding: 15px;
  background: #f5f5f7;
  border-radius: 12px;
}

.quantity-btn {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: #0071e3;
  border: none;
  font-size: 18px;
  font-weight: 600;
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.3s;
}

.quantity-btn:hover {
  background: #005bb5;
}

.quantity-display {
  font-size: 20px;
  font-weight: 600;
  min-width: 40px;
  text-align: center;
}

.quantity-label {
  margin-left: auto;
  font-weight: 600;
  color: #1d1d1f;
}

/* Responsive */
@media (max-width: 768px) {
  .main-container {
    grid-template-columns: 1fr;
  }
  
  .product-section,
  .checkout-section {
    padding: 20px;
  }
  
  .input-field.small {
    width: 100%;
  }
  
  nav {
    flex-wrap: wrap;
    gap: 15px;
  }
}
</style>
</head>

<body>

<div class="header-container">
  <header>
    <a href="./index.html" class="logo">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/fa/Apple_logo_black.svg/488px-Apple_logo_black.svg.png" alt="Apple Logo">
      <span>APPLE STORE</span>
    </a>
    <div class="cart-icon" onclick="window.location.href='mobile.html'">
      <i class="fa-solid fa-bag-shopping"></i>
      <span class="cart-count" id="cartCount">0</span>
    </div>
  </header>
</div>

<nav>
  <!-- <a href="./index.html"><i class="fa-solid fa-house"></i> Home</a> -->
  <a href="./index.html"><i class="fa-solid fa-mobile-screen"></i> Mobile</a>
  <a href="./laptop.html"><i class="fa-solid fa-laptop"></i> Laptop</a>
  <a href="./watch.html"><i class="fa-solid fa-clock"></i> Watch</a>
  <a href="./earbuds.html"><i class="fa-solid fa-headphones"></i> Earbuds</a>
</nav>

<div class="main-container">
  <!-- Product Details -->
  <div class="product-section">
    <div class="product-display" id="productDisplay">
      <!-- Product will be loaded here -->
    </div>
    
    <div class="quantity-controls">
      <button class="quantity-btn" id="decreaseQty">-</button>
      <span class="quantity-display" id="quantityDisplay">1</span>
      <button class="quantity-btn" id="increaseQty">+</button>
      <span class="quantity-label">Quantity</span>
    </div>
    
    <div class="order-summary">
      <div class="summary-item">
        <span>Subtotal:</span>
        <span id="subtotal">₹0</span>
      </div>
      <div class="summary-item">
        <span>Shipping:</span>
        <span>FREE</span>
      </div>
      <div class="summary-item">
        <span>GST (18%):</span>
        <span id="taxAmount">₹0</span>
      </div>
      <div class="summary-item">
        <span>Total Amount:</span>
        <span id="totalAmount">₹0</span>
      </div>
    </div>
  </div>

  <!-- Checkout Form -->
  <div class="checkout-section">
    <h2><i class="fa-solid fa-cart-shopping"></i> Checkout Details</h2>
    
    <!-- Delivery Address -->
    <div class="accordion-item">
      <div class="accordion-header">
        <span><i class="fa-solid fa-location-dot"></i> Delivery Address</span>
        <i class="fa-solid fa-chevron-down"></i>
      </div>
      <div class="accordion-content">
        <div class="form-group">
          <label>Full Name</label>
          <input type="text" id="fullName" class="input-field" placeholder="Enter your full name" required>
        </div>
        
        <div class="form-group">
          <label>Mobile Number</label>
          <input type="tel" id="mobileNumber" class="input-field" placeholder="Enter 10-digit mobile number" pattern="[0-9]{10}" required>
        </div>
        
        <div class="form-group">
          <label>Email Address</label>
          <input type="email" id="emailAddress" class="input-field" placeholder="Enter your email" required>
        </div>
        
        <div class="form-group">
          <label>Complete Address</label>
          <textarea id="completeAddress" class="input-field" rows="3" placeholder="House no., Building, Street, Area" required></textarea>
        </div>
        
        <div style="display: flex; gap: 20px;">
          <div class="form-group" style="flex: 1;">
            <label>City</label>
            <input type="text" id="city" class="input-field" placeholder="City" required>
          </div>
          <div class="form-group" style="flex: 1;">
            <label>Pincode</label>
            <input type="text" id="pincode" class="input-field" placeholder="6-digit pincode" pattern="[0-9]{6}" required>
          </div>
        </div>
        
        <div class="form-group">
          <label>State</label>
          <select id="state" class="input-field" required>
            <option value="">Select State</option>
            <option value="MH">Maharashtra</option>
            <option value="DL">Delhi</option>
            <option value="KA">Karnataka</option>
            <option value="TN">Tamil Nadu</option>
            <option value="TG">Telangana</option>
            <option value="GJ">Gujarat</option>
            <option value="RJ">Rajasthan</option>
            <option value="UP">Uttar Pradesh</option>
            <option value="WB">West Bengal</option>
            <option value="PB">Punjab</option>
          </select>
        </div>
        
        <button id="saveAddressBtn" class="btn btn-success">
          <i class="fa-solid fa-check"></i> Save Address
        </button>
        <div id="addressSavedMsg" style="display: none; color: #34c759; font-weight: 600; margin-top: 10px; text-align: center;">
          <i class="fa-solid fa-check-circle"></i> Address saved successfully!
        </div>
      </div>
    </div>

    <!-- Payment Method -->
    <div class="accordion-item">
      <div class="accordion-header">
        <span><i class="fa-solid fa-credit-card"></i> Payment Method</span>
        <i class="fa-solid fa-chevron-down"></i>
      </div>
      <div class="accordion-content">
        <div class="payment-options">
          <!-- UPI -->
          <label class="payment-option" for="upi">
            <input type="radio" name="payment" id="upi" value="upi">
            <div class="payment-icon"><i class="fa-brands fa-google-pay"></i></div>
            <div class="payment-label">
              <h4>UPI (Google Pay / PhonePe / Paytm)</h4>
              <p>Instant payment using any UPI app</p>
            </div>
          </label>
          
          <!-- Credit/Debit Card -->
          <label class="payment-option" for="card">
            <input type="radio" name="payment" id="card" value="card">
            <div class="payment-icon"><i class="fa-solid fa-credit-card"></i></div>
            <div class="payment-label">
              <h4>Credit / Debit Card</h4>
              <p>Pay using Visa, MasterCard, or RuPay</p>
            </div>
          </label>
          
          <!-- Net Banking -->
          <label class="payment-option" for="netbanking">
            <input type="radio" name="payment" id="netbanking" value="netbanking">
            <div class="payment-icon"><i class="fa-solid fa-building-columns"></i></div>
            <div class="payment-label">
              <h4>Net Banking</h4>
              <p>Transfer directly from your bank</p>
            </div>
          </label>
          
          <!-- EMI -->
          <label class="payment-option" for="emi">
            <input type="radio" name="payment" id="emi" value="emi">
            <div class="payment-icon"><i class="fa-solid fa-calendar-days"></i></div>
            <div class="payment-label">
              <h4>EMI Options</h4>
              <p>Pay in easy monthly installments</p>
            </div>
          </label>
          
          <!-- Cash on Delivery -->
          <label class="payment-option" for="cod">
            <input type="radio" name="payment" id="cod" value="cod">
            <div class="payment-icon"><i class="fa-solid fa-money-bill-wave"></i></div>
            <div class="payment-label">
              <h4>Cash on Delivery</h4>
              <p>Pay when your order arrives</p>
            </div>
          </label>
        </div>
        
        <!-- Payment Details -->
        <div class="payment-details" id="upiDetails">
          <div class="upi-qr">
            <h4><i class="fa-solid fa-qrcode"></i> Scan to Pay</h4>
            <img id="qrCodeImage" src="" alt="UPI QR Code">
            <p>Or use UPI ID:</p>
            <div class="upi-id" id="upiIdDisplay">apple.store@okicici</div>
            <p>Amount: <strong id="upiAmount">₹0</strong></p>
            <button id="upiPaidBtn" class="btn btn-success">
              <i class="fa-solid fa-check"></i> I've Made the Payment
            </button>
          </div>
        </div>
        
        <div class="payment-details" id="cardDetails">
          <div class="form-group">
            <label>Card Number</label>
            <input type="text" id="cardNumber" class="input-field" placeholder="1234 5678 9012 3456" maxlength="19">
          </div>
          
          <div style="display: flex; gap: 20px;">
            <div class="form-group" style="flex: 1;">
              <label>Expiry Date</label>
              <input type="text" id="cardExpiry" class="input-field" placeholder="MM/YY">
            </div>
            <div class="form-group" style="flex: 1;">
              <label>CVV</label>
              <input type="text" id="cardCvv" class="input-field" placeholder="123" maxlength="3">
            </div>
          </div>
          
          <div class="form-group">
            <label>Cardholder Name</label>
            <input type="text" id="cardName" class="input-field" placeholder="Name on card">
          </div>
          
          <button id="cardPayBtn" class="btn btn-primary">
            <i class="fa-solid fa-lock"></i> Pay Securely
          </button>
        </div>
        
        <div class="payment-details" id="netbankingDetails">
          <div class="form-group">
            <label>Select Bank</label>
            <select id="bankSelect" class="input-field">
              <option value="">Select your bank</option>
              <option value="SBI">State Bank of India</option>
              <option value="HDFC">HDFC Bank</option>
              <option value="ICICI">ICICI Bank</option>
              <option value="AXIS">Axis Bank</option>
              <option value="KOTAK">Kotak Mahindra Bank</option>
              <option value="PNB">Punjab National Bank</option>
            </select>
          </div>
          
          <button id="netbankingPayBtn" class="btn btn-primary">
            <i class="fa-solid fa-lock"></i> Continue to Bank
          </button>
        </div>
        
        <div class="payment-details" id="emiDetails">
          <div class="form-group">
            <label>Select EMI Duration</label>
            <select id="emiDuration" class="input-field">
              <option value="">Select EMI plan</option>
              <option value="3">3 Months (No Cost EMI)</option>
              <option value="6">6 Months (5% interest)</option>
              <option value="9">9 Months (8% interest)</option>
              <option value="12">12 Months (12% interest)</option>
            </select>
          </div>
          
          <div id="emiCalculator" class="emi-calculator">
            <div id="emiResult"></div>
          </div>
          
          <button id="emiPayBtn" class="btn btn-primary">
            <i class="fa-solid fa-calendar-check"></i> Proceed with EMI
          </button>
        </div>
      </div>
    </div>

    <!-- Place Order Button -->
    <button id="placeOrderBtn" class="btn btn-primary" disabled>
      <i class="fa-solid fa-bolt"></i> Place Order
    </button>
    
    <a href="mobile.html" class="btn btn-secondary">
      <i class="fa-solid fa-arrow-left"></i> Continue Shopping
    </a>
  </div>
</div>

<script>
// Product data and state
let productData = null;
let quantity = 1;
let basePrice = 0;
let totalPrice = 0;
let selectedPayment = '';
let isAddressSaved = false;

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  console.log("Buy page loaded");
  loadProductData();
  setupEventListeners();
  setupAccordion();
  updateCartCount();
});

// Load product from localStorage
function loadProductData() {
  console.log("Loading product data from localStorage...");
  
  // Debug: Log all localStorage items
  console.log("All localStorage items:");
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    console.log(`${key}:`, localStorage.getItem(key));
  }
  
  // Try multiple possible keys
  const possibleKeys = ['selectedProduct', 'selectedMobile', 'checkoutCart', 'lastOrder'];
  
  for (const key of possibleKeys) {
    const data = localStorage.getItem(key);
    if (data) {
      try {
        const parsed = JSON.parse(data);
        console.log(`Found data in ${key}:`, parsed);
        
        if (key === 'checkoutCart' && Array.isArray(parsed) && parsed.length > 0) {
          productData = parsed[0];
          break;
        } else if (key === 'selectedProduct' || key === 'selectedMobile') {
          productData = parsed;
          break;
        } else if (key === 'lastOrder' && parsed.product) {
          productData = parsed.product;
          break;
        }
      } catch (e) {
        console.error(`Error parsing ${key}:`, e);
      }
    }
  }
  
  if (productData) {
    console.log("Final product data:", productData);
    displayProduct();
    calculateTotal();
  } else {
    console.error("No product data found in localStorage");
    showErrorState();
  }
}

// Display product details
function displayProduct() {
  const container = document.getElementById('productDisplay');
  
  // Extract product details with fallbacks
  const productName = productData.name || "Unknown Product";
  const productDesc = productData.desc || "No description available";
  let productImg = productData.img || "https://via.placeholder.com/300x300?text=No+Image";
  
  // Fix image URL if it has spaces or special characters
  if (productImg.includes(' ')) {
    productImg = encodeURI(productImg);
  }
  
  // Extract price
  let priceDisplay = "";
  let priceValue = 0;
  
  if (productData.priceDisplay) {
    // Format: "₹1,59,900"
    priceDisplay = productData.priceDisplay;
    priceValue = parseInt(productData.priceDisplay.replace(/[^0-9]/g, '')) || 0;
  } else if (productData.price) {
    // Format: 159900 (number) or "159900" (string)
    priceValue = typeof productData.price === 'number' ? productData.price : parseInt(productData.price);
    priceDisplay = `₹${priceValue.toLocaleString('en-IN')}`;
  } else {
    priceDisplay = "₹0";
    priceValue = 0;
  }
  
  basePrice = priceValue;
  
  console.log("Displaying product:", { productName, priceValue, priceDisplay, productImg });
  
  container.innerHTML = `
    <img src="${productImg}" alt="${productName}" onerror="this.onerror=null; this.src='https://via.placeholder.com/300x300?text=Image+Not+Found'">
    <div class="product-title">${productName}</div>
    <div class="product-desc">${productDesc}</div>
    <div class="product-price">${priceDisplay}</div>
  `;
}

// Show error state
function showErrorState() {
  const container = document.getElementById('productDisplay');
  container.innerHTML = `
    <div style="text-align: center; padding: 40px;">
      <i class="fa-solid fa-exclamation-triangle" style="font-size: 48px; color: #ff9500; margin-bottom: 20px;"></i>
      <h3>Product Not Found</h3>
      <p>Please select a product to continue.</p>
      <a href="mobile.html" class="btn btn-primary" style="margin-top: 20px;">Browse Products</a>
    </div>
  `;
}

// Calculate total with tax
function calculateTotal() {
  const subtotal = basePrice * quantity;
  const tax = Math.round(subtotal * 0.18); // 18% GST
  totalPrice = subtotal + tax;
  
  console.log("Calculating total:", { basePrice, quantity, subtotal, tax, totalPrice });
  
  // Update display
  document.getElementById('subtotal').textContent = `₹${subtotal.toLocaleString('en-IN')}`;
  document.getElementById('taxAmount').textContent = `₹${tax.toLocaleString('en-IN')}`;
  document.getElementById('totalAmount').textContent = `₹${totalPrice.toLocaleString('en-IN')}`;
  document.getElementById('quantityDisplay').textContent = quantity;
  
  // Update UPI amount
  document.getElementById('upiAmount').textContent = `₹${totalPrice.toLocaleString('en-IN')}`;
  
  // Update UPI QR code
  updateUpiQrCode();
}

// Setup event listeners
function setupEventListeners() {
  // Quantity controls
  document.getElementById('decreaseQty').addEventListener('click', () => {
    if (quantity > 1) {
      quantity--;
      calculateTotal();
      updatePlaceOrderButton();
    }
  });
  
  document.getElementById('increaseQty').addEventListener('click', () => {
    quantity++;
    calculateTotal();
    updatePlaceOrderButton();
  });
  
  // Save address
  document.getElementById('saveAddressBtn').addEventListener('click', saveAddress);
  
  // Payment method selection
  document.querySelectorAll('input[name="payment"]').forEach(radio => {
    radio.addEventListener('change', handlePaymentSelection);
  });
  
  // Payment buttons
  document.getElementById('upiPaidBtn').addEventListener('click', processUpiPayment);
  document.getElementById('cardPayBtn').addEventListener('click', processCardPayment);
  document.getElementById('netbankingPayBtn').addEventListener('click', processNetbankingPayment);
  document.getElementById('emiPayBtn').addEventListener('click', processEmiPayment);
  
  // EMI calculator
  document.getElementById('emiDuration').addEventListener('change', calculateEMI);
  
  // Place order
  document.getElementById('placeOrderBtn').addEventListener('click', placeOrder);
}

// Setup accordion
function setupAccordion() {
  document.querySelectorAll('.accordion-header').forEach(header => {
    header.addEventListener('click', () => {
      const content = header.nextElementSibling;
      const icon = header.querySelector('.fa-chevron-down');
      
      content.classList.toggle('active');
      icon.style.transform = content.classList.contains('active') ? 'rotate(180deg)' : 'rotate(0)';
    });
  });
}

// Save address
function saveAddress() {
  const fullName = document.getElementById('fullName').value.trim();
  const mobileNumber = document.getElementById('mobileNumber').value.trim();
  const email = document.getElementById('emailAddress').value.trim();
  const address = document.getElementById('completeAddress').value.trim();
  const city = document.getElementById('city').value.trim();
  const pincode = document.getElementById('pincode').value.trim();
  const state = document.getElementById('state').value;
  
  // Basic validation
  if (!fullName || !mobileNumber || !email || !address || !city || !pincode || !state) {
    alert('Please fill all required fields.');
    return;
  }
  
  if (!/^\d{10}$/.test(mobileNumber)) {
    alert('Please enter a valid 10-digit mobile number.');
    return;
  }
  
  if (!/^\d{6}$/.test(pincode)) {
    alert('Please enter a valid 6-digit pincode.');
    return;
  }
  
  if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
    alert('Please enter a valid email address.');
    return;
  }
  
  // Save to localStorage
  const addressData = {
    fullName,
    mobileNumber,
    email,
    address,
    city,
    pincode,
    state,
    timestamp: new Date().toISOString()
  };
  
  localStorage.setItem('shippingAddress', JSON.stringify(addressData));
  
  // Show success message
  const msg = document.getElementById('addressSavedMsg');
  msg.style.display = 'block';
  isAddressSaved = true;
  
  // Enable place order button
  updatePlaceOrderButton();
  
  // Hide message after 3 seconds
  setTimeout(() => {
    msg.style.display = 'none';
  }, 3000);
}

// Handle payment selection
function handlePaymentSelection(e) {
  selectedPayment = e.target.value;
  
  // Hide all payment details
  document.querySelectorAll('.payment-details').forEach(detail => {
    detail.classList.remove('active');
  });
  
  // Remove selected class from all payment options
  document.querySelectorAll('.payment-option').forEach(option => {
    option.classList.remove('selected');
  });
  
  // Add selected class to clicked option
  const parent = e.target.closest('.payment-option');
  if (parent) {
    parent.classList.add('selected');
  }
  
  // Show corresponding payment details
  if (selectedPayment === 'upi') {
    document.getElementById('upiDetails').classList.add('active');
  } else if (selectedPayment === 'card') {
    document.getElementById('cardDetails').classList.add('active');
  } else if (selectedPayment === 'netbanking') {
    document.getElementById('netbankingDetails').classList.add('active');
  } else if (selectedPayment === 'emi') {
    document.getElementById('emiDetails').classList.add('active');
    calculateEMI();
  }
  
  // Enable place order button
  updatePlaceOrderButton();
}

// Update UPI QR code
function updateUpiQrCode() {
  const upiId = "apple.store@okicici";
  const amount = totalPrice;
  const productName = productData?.name || "Apple Product";
  
  // Create UPI payment link
  const upiLink = `upi://pay?pa=${upiId}&pn=Apple%20Store&am=${amount}&cu=INR&tn=Payment%20for%20${encodeURIComponent(productName.substring(0, 50))}`;
  
  // Generate QR code using QR Server API
  const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(upiLink)}`;
  document.getElementById('qrCodeImage').src = qrCodeUrl;
  document.getElementById('upiIdDisplay').textContent = upiId;
}

// Calculate EMI
function calculateEMI() {
  const duration = parseInt(document.getElementById('emiDuration').value);
  if (!duration) return;
  
  let interestRate;
  let emiAmount;
  
  switch(duration) {
    case 3:
      interestRate = 0;
      break;
    case 6:
      interestRate = 0.05;
      break;
    case 9:
      interestRate = 0.08;
      break;
    case 12:
      interestRate = 0.12;
      break;
    default:
      interestRate = 0;
  }
  
  const totalWithInterest = totalPrice * (1 + interestRate);
  emiAmount = Math.round(totalWithInterest / duration);
  
  document.getElementById('emiResult').innerHTML = `
    <div style="text-align: center;">
      <h4>EMI Breakdown</h4>
      <p>Total Amount: ₹${totalPrice.toLocaleString('en-IN')}</p>
      <p>Interest Rate: ${(interestRate * 100).toFixed(1)}%</p>
      <p>Total with Interest: ₹${totalWithInterest.toLocaleString('en-IN')}</p>
      <p style="font-size: 20px; color: #0071e3; font-weight: 700;">
        EMI: ₹${emiAmount.toLocaleString('en-IN')} for ${duration} months
      </p>
    </div>
  `;
}

// Payment processing functions
function processUpiPayment() {
  localStorage.setItem('lastPaymentMethod', 'UPI');
  localStorage.setItem('lastQuantity', quantity);
  placeOrder();
}

function processCardPayment() {
  const cardNumber = document.getElementById('cardNumber').value.trim();
  const expiry = document.getElementById('cardExpiry').value.trim();
  const cvv = document.getElementById('cardCvv').value.trim();
  const name = document.getElementById('cardName').value.trim();
  
  if (!cardNumber || !expiry || !cvv || !name) {
    alert('Please fill all card details.');
    return;
  }
  
  // Simple validation
  const cleanCardNumber = cardNumber.replace(/\s/g, '');
  if (!/^\d{16}$/.test(cleanCardNumber)) {
    alert('Please enter a valid 16-digit card number.');
    return;
  }
  
  if (!/^\d{2}\/\d{2}$/.test(expiry)) {
    alert('Please enter expiry date in MM/YY format.');
    return;
  }
  
  if (!/^\d{3}$/.test(cvv)) {
    alert('Please enter a valid 3-digit CVV.');
    return;
  }
  
  localStorage.setItem('lastPaymentMethod', 'Credit/Debit Card');
  localStorage.setItem('lastQuantity', quantity);
  placeOrder();
}

function processNetbankingPayment() {
  const bank = document.getElementById('bankSelect').value;
  if (!bank) {
    alert('Please select your bank.');
    return;
  }
  
  localStorage.setItem('lastPaymentMethod', 'Net Banking');
  localStorage.setItem('lastQuantity', quantity);
  localStorage.setItem('selectedBank', bank);
  placeOrder();
}

function processEmiPayment() {
  const duration = document.getElementById('emiDuration').value;
  if (!duration) {
    alert('Please select EMI duration.');
    return;
  }
  
  localStorage.setItem('lastPaymentMethod', 'EMI');
  localStorage.setItem('lastQuantity', quantity);
  localStorage.setItem('emiDuration', duration);
  placeOrder();
}

// Update place order button state
function updatePlaceOrderButton() {
  const placeOrderBtn = document.getElementById('placeOrderBtn');
  const canPlaceOrder = isAddressSaved && selectedPayment;
  
  placeOrderBtn.disabled = !canPlaceOrder;
  
  if (placeOrderBtn.disabled) {
    placeOrderBtn.innerHTML = '<i class="fa-solid fa-bolt"></i> Complete Details to Place Order';
    placeOrderBtn.style.background = '#86868b';
  } else {
    placeOrderBtn.innerHTML = `<i class="fa-solid fa-bolt"></i> Place Order - ₹${totalPrice.toLocaleString('en-IN')}`;
    placeOrderBtn.style.background = '';
  }
}

// Place order
function placeOrder() {
  if (!isAddressSaved) {
    alert('Please save your delivery address first.');
    return;
  }
  
  if (!selectedPayment) {
    alert('Please select a payment method.');
    return;
  }
  
  // Save order details to localStorage for success page
  const orderData = {
    product: productData,
    quantity: quantity,
    totalPrice: totalPrice,
    paymentMethod: selectedPayment,
    timestamp: new Date().toISOString(),
    orderId: 'AS-' + Date.now().toString().slice(-8)
  };
  
  localStorage.setItem('lastOrder', JSON.stringify(orderData));
  
  // For backward compatibility
  localStorage.setItem('selectedMobile', JSON.stringify(productData));
  localStorage.setItem('lastQuantity', quantity);
  localStorage.setItem('lastPaymentMethod', selectedPayment.charAt(0).toUpperCase() + selectedPayment.slice(1));
  
  // Show loading state
  const placeOrderBtn = document.getElementById('placeOrderBtn');
  const originalText = placeOrderBtn.innerHTML;
  placeOrderBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Processing...';
  placeOrderBtn.disabled = true;
  
  // Simulate processing delay
  setTimeout(() => {
    // Redirect to success page
    window.location.href = 'success.html';
  }, 1500);
}

// Update cart count
function updateCartCount() {
  const cart = JSON.parse(localStorage.getItem('cart')) || [];
  const totalItems = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
  document.getElementById('cartCount').textContent = totalItems;
  document.getElementById('cartCount').style.display = totalItems > 0 ? 'flex' : 'none';
}
</script>

</body>
</html>
